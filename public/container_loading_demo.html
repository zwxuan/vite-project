<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›†è£…ç®±è£…ç®±ä¼˜åŒ–ä¸å¯è§†åŒ–ç³»ç»Ÿ - å¢å¼ºç‰ˆ</title>
    <style>
        body { font-family: 'Microsoft YaHei', Arial, sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #333; }
        .main-container { max-width: 1400px; margin: 0 auto; }
        h1 { color: white; text-align: center; margin-bottom: 30px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .dashboard { display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        .panel { background: white; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); padding: 20px; backdrop-filter: blur(10px); }
        .cargo-management { min-height: 600px; }
        .visualization { min-height: 600px; position: relative; }
        .controls-panel { min-height: 600px; }
        #scene-container { width: 100%; height: 500px; background: linear-gradient(45deg, #f0f0f0, #e0e0e0); border-radius: 8px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50; }
        .form-group input, .form-group select { width: calc(100% - 24px); padding: 10px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px; transition: border-color 0.3s; box-sizing: border-box; }
        .form-group input[type="checkbox"] { width: auto; margin-right: 8px; }
        .form-group label.checkbox-label { display: flex; align-items: center; margin-bottom: 5px; font-weight: 600; color: #2c3e50; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #3498db; }
        .btn { background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; margin: 5px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4); }
        .btn-success { background: linear-gradient(45deg, #27ae60, #229954); }
        .btn-warning { background: linear-gradient(45deg, #f39c12, #e67e22); }
        .btn-danger { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: linear-gradient(45deg, #34495e, #2c3e50); color: white; }
        .metrics-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .metric-card { background: linear-gradient(45deg, #ecf0f1, #bdc3c7); padding: 15px; border-radius: 8px; text-align: center; }
        .metric-value { font-size: 24px; font-weight: bold; color: #2c3e50; }
        .metric-label { font-size: 12px; color: #7f8c8d; margin-top: 5px; }
        .algorithm-selector { margin: 15px 0; }
        .progress-bar { width: 100%; height: 20px; background: #ecf0f1; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(45deg, #27ae60, #2ecc71); transition: width 0.3s; }
        .cargo-preview { width: 40px; height: 40px; background: #f8f9fa; border: 1px solid #dee2e6; display: flex; align-items: center; justify-content: center; border-radius: 4px; }
        .cargo-shape { border-radius: 2px; }
        .comparison-panel { grid-column: 1 / -1; margin-top: 20px; }
        .comparison-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .solution-card { background: white; border-radius: 8px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .tabs { display: flex; margin-bottom: 20px; }
        .tab { padding: 10px 20px; background: #ecf0f1; border: none; cursor: pointer; border-radius: 6px 6px 0 0; margin-right: 5px; }
        .tab.active { background: #3498db; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="main-container">
        <h1>ğŸš¢ é›†è£…ç®±è£…ç®±ä¼˜åŒ–ä¸å¯è§†åŒ–ç³»ç»Ÿ - å¢å¼ºç‰ˆ</h1>
        
        <div class="dashboard">
            <!-- è´§ç‰©ä¿¡æ¯ç®¡ç†é¢æ¿ -->
            <div class="panel cargo-management">
                <h2>ğŸ“¦ è´§ç‰©ä¿¡æ¯ç®¡ç†</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('basic')">åŸºç¡€ä¿¡æ¯</button>
                    <button class="tab" onclick="switchTab('advanced')">é«˜çº§å±æ€§</button>
                    <button class="tab" onclick="switchTab('batch')">æ‰¹é‡å¯¼å…¥</button>
                </div>
                
                <div id="basic-tab" class="tab-content active">
                    <div class="form-group">
                        <label for="container-type">é›†è£…ç®±è§„æ ¼</label>
                        <select id="container-type">
                            <option value="20ft">20ft GP (5.89Ã—2.35Ã—2.39m)</option>
                            <option value="40ft">40ft GP (12.03Ã—2.35Ã—2.39m)</option>
                            <option value="40ft-hq">40ft HQ (12.03Ã—2.35Ã—2.69m)</option>
                            <option value="45ft">45ft HQ (13.56Ã—2.35Ã—2.69m)</option>
                        </select>
                    </div>
                    
                    <form id="cargo-form">
                        <div class="form-group">
                            <label for="cargo-name">è´§ç‰©åç§°</label>
                            <input type="text" id="cargo-name" placeholder="ä¾‹å¦‚ï¼šçº¸ç®±ã€æœºæ¢°è®¾å¤‡" required>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                            <div class="form-group">
                                <label for="length">é•¿ (m)</label>
                                <input type="number" id="length" value="1.2" step="0.01" min="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="width">å®½ (m)</label>
                                <input type="number" id="width" value="0.8" step="0.01" min="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="height">é«˜ (m)</label>
                                <input type="number" id="height" value="1.0" step="0.01" min="0.01" required>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div class="form-group">
                                <label for="weight">é‡é‡ (kg)</label>
                                <input type="number" id="weight" value="100" step="0.1" min="0.1" required>
                            </div>
                            <div class="form-group">
                                <label for="quantity">æ•°é‡</label>
                                <input type="number" id="quantity" value="10" min="1" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">â• æ·»åŠ è´§ç‰©</button>
                    </form>
                </div>
                
                <div id="advanced-tab" class="tab-content">
                    <div class="form-group">
                        <label for="fragile">æ˜“ç¢å“</label>
                        <select id="fragile">
                            <option value="false">å¦</option>
                            <option value="true">æ˜¯</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="stackable">å¯å †å </label>
                        <select id="stackable">
                            <option value="true">æ˜¯</option>
                            <option value="false">å¦</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="max-stack">æœ€å¤§å †å å±‚æ•°</label>
                        <input type="number" id="max-stack" value="5" min="1">
                    </div>
                    <div class="form-group">
                        <label for="rotation">å…è®¸æ—‹è½¬</label>
                        <select id="rotation">
                            <option value="true">æ˜¯</option>
                            <option value="false">å¦</option>
                        </select>
                    </div>
                </div>
                
                <div id="batch-tab" class="tab-content">
                    <div class="form-group">
                        <label for="csv-file">CSVæ–‡ä»¶å¯¼å…¥</label>
                        <input type="file" id="csv-file" accept=".csv,.xlsx">
                    </div>
                    <button type="button" class="btn" onclick="downloadTemplate()">ğŸ“¥ ä¸‹è½½æ¨¡æ¿</button>
                    <button type="button" class="btn btn-success" onclick="importCargo()">ğŸ“¤ å¯¼å…¥è´§ç‰©</button>
                </div>
                
                <h3>ğŸ“‹ è´§ç‰©åˆ—è¡¨</h3>
                <div style="max-height: 300px; overflow-y: auto;">
                    <table id="cargo-table">
                        <thead>
                            <tr>
                                <th>é¢„è§ˆ</th>
                                <th>åç§°</th>
                                <th>å°ºå¯¸(LÃ—WÃ—H)</th>
                                <th>é‡é‡</th>
                                <th>æ•°é‡</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="cargo-list-body"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- 3Då¯è§†åŒ–é¢æ¿ -->
            <div class="panel visualization">
                <h2>ğŸ¯ 3D å¯è§†åŒ–è£…ç®±æ–¹æ¡ˆ</h2>
                <div id="scene-container"></div>
                <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <button class="btn" onclick="resetCamera()">ğŸ¥ é‡ç½®è§†è§’</button>
                        <button class="btn" onclick="toggleWireframe()">ğŸ“ çº¿æ¡†æ¨¡å¼</button>
                        <button class="btn" onclick="exportModel()">ğŸ’¾ å¯¼å‡ºæ¨¡å‹</button>
                    </div>
                    <div>
                        <label>è§†å›¾: </label>
                        <select id="view-mode" onchange="changeView()">
                            <option value="perspective">é€è§†å›¾</option>
                            <option value="top">ä¿¯è§†å›¾</option>
                            <option value="side">ä¾§è§†å›¾</option>
                            <option value="front">æ­£è§†å›¾</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- æ§åˆ¶ä¸ä¼˜åŒ–é¢æ¿ -->
            <div class="panel controls-panel">
                <h2>âš™ï¸ ç®—æ³•æ§åˆ¶ä¸ä¼˜åŒ–</h2>
                
                <div class="algorithm-selector">
                    <label for="algorithm">è£…ç®±ç®—æ³•</label>
                    <select id="algorithm">
                        <option value="greedy">è´ªå¿ƒç®—æ³• (å¿«é€Ÿ)</option>
                        <option value="genetic">é—ä¼ ç®—æ³• (æœ€ä¼˜)</option>
                        <option value="simulated">æ¨¡æ‹Ÿé€€ç« (å¹³è¡¡)</option>
                        <option value="hybrid">æ··åˆç®—æ³• (æ¨è)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="optimization-time">ä¼˜åŒ–æ—¶é—´ (ç§’)</label>
                    <input type="range" id="optimization-time" min="5" max="60" value="15">
                    <span id="time-display">15ç§’</span>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="weight-balance" checked> é‡å¿ƒå¹³è¡¡çº¦æŸ
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="fragile-protection" checked> æ˜“ç¢å“ä¿æŠ¤
                    </label>
                </div>
                
                <button class="btn btn-success" onclick="calculateOptimal()" style="width: 100%; margin: 10px 0;">ğŸš€ ç”Ÿæˆæœ€ä¼˜æ–¹æ¡ˆ</button>
                
                <div id="calculation-progress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div style="text-align: center; margin-top: 5px;">è®¡ç®—ä¸­... <span id="progress-text">0%</span></div>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="load-ratio">0%</div>
                        <div class="metric-label">è£…è½½ç‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="loaded-items">0</div>
                        <div class="metric-label">å·²è£…è½½</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="total-weight">0kg</div>
                        <div class="metric-label">æ€»é‡é‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="center-deviation">0cm</div>
                        <div class="metric-label">é‡å¿ƒåç§»</div>
                    </div>
                </div>
                
                <h3>ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”</h3>
                <div id="solutions-list"></div>
                <button class="btn" onclick="saveSolution()">ğŸ’¾ ä¿å­˜å½“å‰æ–¹æ¡ˆ</button>
                <button class="btn btn-warning" onclick="clearSolutions()">ğŸ—‘ï¸ æ¸…ç©ºæ–¹æ¡ˆ</button>
                
                <h3>ğŸ“¤ å¯¼å‡ºé€‰é¡¹</h3>
                <button class="btn" onclick="exportPDF()">ğŸ“„ å¯¼å‡ºPDF</button>
                <button class="btn" onclick="exportExcel()">ğŸ“Š å¯¼å‡ºExcel</button>
                <button class="btn btn-danger" onclick="resetAll()">ğŸ”„ é‡ç½®æ‰€æœ‰</button>
            </div>
        </div>
        
        <!-- æ–¹æ¡ˆå¯¹æ¯”é¢æ¿ -->
        <div class="panel comparison-panel" id="comparison-panel" style="display: none;">
            <h2>ğŸ“ˆ æ–¹æ¡ˆå¯¹æ¯”åˆ†æ</h2>
            <div class="comparison-grid" id="comparison-grid"></div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let cargoItems = [];
        let solutions = [];
        let currentSolution = null;
        let scene, camera, renderer, controls;
        let containerGroup, cargoGroup;
        
        // é›†è£…ç®±è§„æ ¼æ•°æ®
        const containerDimensions = {
            '20ft': { length: 5.89, width: 2.35, height: 2.39, maxWeight: 28230 },
            '40ft': { length: 12.03, width: 2.35, height: 2.39, maxWeight: 28750 },
            '40ft-hq': { length: 12.03, width: 2.35, height: 2.69, maxWeight: 28750 },
            '45ft': { length: 13.56, width: 2.35, height: 2.69, maxWeight: 29000 }
        };
        
        // è´§ç‰©ç±»å®šä¹‰
        class Cargo {
            constructor(data) {
                this.id = Date.now() + Math.random();
                this.name = data.name || 'æœªå‘½åè´§ç‰©';
                this.length = parseFloat(data.length);
                this.width = parseFloat(data.width);
                this.height = parseFloat(data.height);
                this.weight = parseFloat(data.weight);
                this.quantity = parseInt(data.quantity);
                this.fragile = data.fragile === 'true';
                this.stackable = data.stackable !== 'false';
                this.maxStack = parseInt(data.maxStack) || 5;
                this.rotation = data.rotation !== 'false';
                this.color = this.generateColor();
            }
            
            generateColor() {
                const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
                return colors[Math.floor(Math.random() * colors.length)];
            }
            
            getVolume() {
                return this.length * this.width * this.height;
            }
            
            getTotalWeight() {
                return this.weight * this.quantity;
            }
        }
        
        // è£…ç®±æ–¹æ¡ˆç±»
        class PackingSolution {
            constructor(algorithm, placements, metrics) {
                this.id = Date.now();
                this.algorithm = algorithm;
                this.placements = placements;
                this.metrics = metrics;
                this.timestamp = new Date();
            }
        }
        
        // åˆå§‹åŒ–3Dåœºæ™¯
        function initScene() {
            const container = document.getElementById('scene-container');
            
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);
            
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // ç¯å…‰è®¾ç½®
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // æ§åˆ¶å™¨
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            drawContainer();
            animate();
        }
        
        // ç»˜åˆ¶é›†è£…ç®±
        function drawContainer() {
            if (containerGroup) scene.remove(containerGroup);
            
            containerGroup = new THREE.Group();
            const type = document.getElementById('container-type').value;
            const dims = containerDimensions[type];
            
            // é›†è£…ç®±ä¸»ä½“ï¼ˆé€æ˜ï¼‰
            const geometry = new THREE.BoxGeometry(dims.length, dims.height, dims.width);
            const material = new THREE.MeshStandardMaterial({
                color: 0x4A90E2,
                opacity: 0.1,
                transparent: true,
                side: THREE.DoubleSide
            });
            
            const containerMesh = new THREE.Mesh(geometry, material);
            containerMesh.receiveShadow = true;
            
            // è¾¹æ¡†
            const edges = new THREE.EdgesGeometry(geometry);
            const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0x000000, linewidth: 2 }));
            containerMesh.add(line);
            
            containerGroup.add(containerMesh);
            
            // åœ°é¢ç½‘æ ¼
            const gridHelper = new THREE.GridHelper(Math.max(dims.length, dims.width) + 4, 20);
            gridHelper.position.y = -dims.height / 2;
            containerGroup.add(gridHelper);
            
            scene.add(containerGroup);
            
            // è®¾ç½®ç›¸æœºä½ç½®
            camera.position.set(dims.length * 1.5, dims.height * 2, dims.width * 1.5);
            controls.target.set(0, 0, 0);
            controls.update();
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }
        
        // è¡¨å•æäº¤å¤„ç†
        document.getElementById('cargo-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('cargo-name').value,
                length: document.getElementById('length').value,
                width: document.getElementById('width').value,
                height: document.getElementById('height').value,
                weight: document.getElementById('weight').value,
                quantity: document.getElementById('quantity').value,
                fragile: document.getElementById('fragile').value,
                stackable: document.getElementById('stackable').value,
                maxStack: document.getElementById('max-stack').value,
                rotation: document.getElementById('rotation').value
            };
            
            const cargo = new Cargo(formData);
            cargoItems.push(cargo);
            updateCargoList();
            this.reset();
            
            // é‡ç½®ä¸ºé»˜è®¤å€¼
            document.getElementById('cargo-name').value = '';
            document.getElementById('length').value = '1.2';
            document.getElementById('width').value = '0.8';
            document.getElementById('height').value = '1.0';
            document.getElementById('weight').value = '100';
            document.getElementById('quantity').value = '10';
        });
        
        // æ›´æ–°è´§ç‰©åˆ—è¡¨
        function updateCargoList() {
            const tbody = document.getElementById('cargo-list-body');
            tbody.innerHTML = '';
            
            cargoItems.forEach((cargo, index) => {
                const row = document.createElement('tr');
                
                // è®¡ç®—é¢„è§ˆå°ºå¯¸
                const maxDim = 30;
                const scale = maxDim / Math.max(cargo.length, cargo.width, cargo.height);
                const previewWidth = Math.max(cargo.width * scale, 8);
                const previewHeight = Math.max(cargo.height * scale, 8);
                
                row.innerHTML = `
                    <td>
                        <div class="cargo-preview">
                            <div class="cargo-shape" style="width:${previewWidth}px; height:${previewHeight}px; background-color:${cargo.color};"></div>
                        </div>
                    </td>
                    <td title="${cargo.name}">${cargo.name.length > 8 ? cargo.name.substring(0, 8) + '...' : cargo.name}</td>
                    <td>${cargo.length}Ã—${cargo.width}Ã—${cargo.height}</td>
                    <td>${cargo.weight}kg</td>
                    <td>${cargo.quantity}</td>
                    <td><button class="btn btn-danger" style="padding: 2px 6px; font-size: 10px;" onclick="removeCargo(${index})">åˆ é™¤</button></td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // åˆ é™¤è´§ç‰©
        function removeCargo(index) {
            cargoItems.splice(index, 1);
            updateCargoList();
        }
        
        // ä¼˜åŒ–æ—¶é—´æ»‘å—
        document.getElementById('optimization-time').addEventListener('input', function() {
            document.getElementById('time-display').textContent = this.value + 'ç§’';
        });
        
        // é›†è£…ç®±ç±»å‹å˜æ›´
        document.getElementById('container-type').addEventListener('change', drawContainer);
        
        // ç”Ÿæˆæœ€ä¼˜è£…ç®±æ–¹æ¡ˆ
        function calculateOptimal() {
            if (cargoItems.length === 0) {
                alert('è¯·å…ˆæ·»åŠ è´§ç‰©ï¼');
                return;
            }
            
            const algorithm = document.getElementById('algorithm').value;
            const optimizationTime = parseInt(document.getElementById('optimization-time').value);
            
            showProgress();
            
            // æ¨¡æ‹Ÿç®—æ³•è®¡ç®—è¿‡ç¨‹
            simulateCalculation(algorithm, optimizationTime);
        }
        
        // æ˜¾ç¤ºè®¡ç®—è¿›åº¦
        function showProgress() {
            document.getElementById('calculation-progress').style.display = 'block';
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('calculation-progress').style.display = 'none';
                        generatePackingResult();
                    }, 500);
                }
                
                progressFill.style.width = progress + '%';
                progressText.textContent = Math.round(progress) + '%';
            }, 200);
        }
        
        // æ¨¡æ‹Ÿç®—æ³•è®¡ç®—
        function simulateCalculation(algorithm, time) {
            // è¿™é‡Œå¯ä»¥å®ç°çœŸå®çš„ç®—æ³•é€»è¾‘
            console.log(`ä½¿ç”¨${algorithm}ç®—æ³•ï¼Œä¼˜åŒ–æ—¶é—´${time}ç§’`);
        }
        
        // ç”Ÿæˆè£…ç®±ç»“æœ
        function generatePackingResult() {
            // æ¸…é™¤ç°æœ‰è´§ç‰©
            if (cargoGroup) scene.remove(cargoGroup);
            cargoGroup = new THREE.Group();
            
            const containerType = document.getElementById('container-type').value;
            const container = containerDimensions[containerType];
            
            let currentX = -container.length / 2;
            let currentY = -container.height / 2;
            let currentZ = -container.width / 2;
            let totalVolume = 0;
            let totalWeight = 0;
            let loadedCount = 0;
            let placements = [];
            
            // æ”¹è¿›çš„è£…ç®±ç®—æ³•
            for (const cargo of cargoItems) {
                for (let i = 0; i < cargo.quantity; i++) {
                    // æ£€æŸ¥æ˜¯å¦éœ€è¦æ¢è¡Œ
                    if (currentX + cargo.length > container.length / 2) {
                        currentX = -container.length / 2;
                        currentZ += 1.0; // å›ºå®šé—´è·
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦éœ€è¦æ¢å±‚
                    if (currentZ + cargo.width > container.width / 2) {
                        currentZ = -container.width / 2;
                        currentY += 1.2; // å›ºå®šé«˜åº¦
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦è¶…å‡ºå®¹å™¨é«˜åº¦
                    if (currentY + cargo.height > container.height / 2) {
                        break;
                    }
                    
                    // æ£€æŸ¥é‡é‡é™åˆ¶
                    if (totalWeight + cargo.weight > container.maxWeight) {
                        break;
                    }
                    
                    // åˆ›å»ºè´§ç‰©3Dæ¨¡å‹
                    const geometry = new THREE.BoxGeometry(cargo.length, cargo.height, cargo.width);
                    const material = new THREE.MeshStandardMaterial({ 
                        color: cargo.color,
                        transparent: true,
                        opacity: 0.8
                    });
                    
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.position.set(
                        currentX + cargo.length / 2,
                        currentY + cargo.height / 2,
                        currentZ + cargo.width / 2
                    );
                    
                    mesh.castShadow = true;
                    mesh.receiveShadow = true;
                    
                    // æ·»åŠ è¾¹æ¡†
                    const edges = new THREE.EdgesGeometry(geometry);
                    const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0x000000 }));
                    mesh.add(line);
                    
                    cargoGroup.add(mesh);
                    
                    // è®°å½•æ”¾ç½®ä¿¡æ¯
                    placements.push({
                        cargo: cargo,
                        position: { x: mesh.position.x, y: mesh.position.y, z: mesh.position.z },
                        rotation: { x: 0, y: 0, z: 0 }
                    });
                    
                    currentX += cargo.length;
                    totalVolume += cargo.getVolume();
                    totalWeight += cargo.weight;
                    loadedCount++;
                }
            }
            
            scene.add(cargoGroup);
            
            // æ›´æ–°æŒ‡æ ‡
            const containerVolume = container.length * container.width * container.height;
            const loadRatio = (totalVolume / containerVolume * 100).toFixed(1);
            const centerDeviation = calculateCenterDeviation(placements, container);
            
            document.getElementById('load-ratio').textContent = loadRatio + '%';
            document.getElementById('loaded-items').textContent = loadedCount;
            document.getElementById('total-weight').textContent = totalWeight.toFixed(0) + 'kg';
            document.getElementById('center-deviation').textContent = centerDeviation.toFixed(1) + 'cm';
            
            // ä¿å­˜å½“å‰æ–¹æ¡ˆ
            const algorithm = document.getElementById('algorithm').value;
            currentSolution = new PackingSolution(algorithm, placements, {
                loadRatio: parseFloat(loadRatio),
                loadedItems: loadedCount,
                totalWeight: totalWeight,
                centerDeviation: centerDeviation
            });
        }
        
        // è®¡ç®—é‡å¿ƒåç§»
        function calculateCenterDeviation(placements, container) {
            if (placements.length === 0) return 0;
            
            let totalWeight = 0;
            let weightedX = 0;
            let weightedZ = 0;
            
            placements.forEach(placement => {
                const weight = placement.cargo.weight;
                totalWeight += weight;
                weightedX += placement.position.x * weight;
                weightedZ += placement.position.z * weight;
            });
            
            const centerX = weightedX / totalWeight;
            const centerZ = weightedZ / totalWeight;
            
            // è®¡ç®—åç¦»å®¹å™¨ä¸­å¿ƒçš„è·ç¦»
            const deviation = Math.sqrt(centerX * centerX + centerZ * centerZ);
            return deviation * 100; // è½¬æ¢ä¸ºå˜ç±³
        }
        
        // ä¿å­˜æ–¹æ¡ˆ
        function saveSolution() {
            if (!currentSolution) {
                alert('è¯·å…ˆç”Ÿæˆè£…ç®±æ–¹æ¡ˆï¼');
                return;
            }
            
            solutions.push(currentSolution);
            updateSolutionsList();
            alert('æ–¹æ¡ˆå·²ä¿å­˜ï¼');
        }
        
        // æ›´æ–°æ–¹æ¡ˆåˆ—è¡¨
        function updateSolutionsList() {
            const container = document.getElementById('solutions-list');
            container.innerHTML = '';
            
            solutions.forEach((solution, index) => {
                const div = document.createElement('div');
                div.style.cssText = 'background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 5px; font-size: 12px;';
                div.innerHTML = `
                    <strong>æ–¹æ¡ˆ ${index + 1}</strong> (${solution.algorithm})<br>
                    è£…è½½ç‡: ${solution.metrics.loadRatio}% | è´§ç‰©: ${solution.metrics.loadedItems}ä»¶<br>
                    <button class="btn" style="padding: 2px 8px; margin-top: 5px;" onclick="loadSolution(${index})">åŠ è½½</button>
                    <button class="btn btn-danger" style="padding: 2px 8px; margin-top: 5px;" onclick="deleteSolution(${index})">åˆ é™¤</button>
                `;
                container.appendChild(div);
            });
        }
        
        // åŠ è½½æ–¹æ¡ˆ
        function loadSolution(index) {
            const solution = solutions[index];
            // è¿™é‡Œå¯ä»¥å®ç°åŠ è½½æŒ‡å®šæ–¹æ¡ˆçš„é€»è¾‘
            alert(`åŠ è½½æ–¹æ¡ˆ ${index + 1}`);
        }
        
        // åˆ é™¤æ–¹æ¡ˆ
        function deleteSolution(index) {
            solutions.splice(index, 1);
            updateSolutionsList();
        }
        
        // æ¸…ç©ºæ‰€æœ‰æ–¹æ¡ˆ
        function clearSolutions() {
            solutions = [];
            updateSolutionsList();
        }
        
        // é‡ç½®ç›¸æœº
        function resetCamera() {
            const containerType = document.getElementById('container-type').value;
            const dims = containerDimensions[containerType];
            camera.position.set(dims.length * 1.5, dims.height * 2, dims.width * 1.5);
            controls.target.set(0, 0, 0);
            controls.update();
        }
        
        // åˆ‡æ¢çº¿æ¡†æ¨¡å¼
        let wireframeMode = false;
        function toggleWireframe() {
            wireframeMode = !wireframeMode;
            if (cargoGroup) {
                cargoGroup.children.forEach(mesh => {
                    if (mesh.material) {
                        mesh.material.wireframe = wireframeMode;
                    }
                });
            }
        }
        
        // æ”¹å˜è§†å›¾
        function changeView() {
            const viewMode = document.getElementById('view-mode').value;
            const containerType = document.getElementById('container-type').value;
            const dims = containerDimensions[containerType];
            
            switch(viewMode) {
                case 'top':
                    camera.position.set(0, dims.height * 3, 0);
                    break;
                case 'side':
                    camera.position.set(dims.length * 2, dims.height, 0);
                    break;
                case 'front':
                    camera.position.set(0, dims.height, dims.width * 2);
                    break;
                default:
                    camera.position.set(dims.length * 1.5, dims.height * 2, dims.width * 1.5);
            }
            controls.target.set(0, 0, 0);
            controls.update();
        }
        
        // å¯¼å‡ºåŠŸèƒ½
        function exportModel() {
            alert('3Dæ¨¡å‹å¯¼å‡ºåŠŸèƒ½ï¼ˆéœ€è¦é›†æˆGLTFExporterï¼‰');
        }
        
        function exportPDF() {
            alert('PDFå¯¼å‡ºåŠŸèƒ½ï¼ˆéœ€è¦é›†æˆjsPDFåº“ï¼‰');
        }
        
        function exportExcel() {
            alert('Excelå¯¼å‡ºåŠŸèƒ½ï¼ˆéœ€è¦é›†æˆSheetJSåº“ï¼‰');
        }
        
        // ä¸‹è½½æ¨¡æ¿
        function downloadTemplate() {
            const csvContent = "è´§ç‰©åç§°,é•¿(m),å®½(m),é«˜(m),é‡é‡(kg),æ•°é‡,æ˜“ç¢å“,å¯å †å \nçº¸ç®±,1.2,0.8,1.0,100,10,å¦,æ˜¯\næœºæ¢°è®¾å¤‡,2.0,1.5,1.8,500,2,æ˜¯,å¦";
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'è´§ç‰©ä¿¡æ¯æ¨¡æ¿.csv';
            link.click();
        }
        
        // å¯¼å…¥è´§ç‰©
        function importCargo() {
            const fileInput = document.getElementById('csv-file');
            if (!fileInput.files[0]) {
                alert('è¯·é€‰æ‹©æ–‡ä»¶ï¼');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const csv = e.target.result;
                const lines = csv.split('\n');
                
                // è·³è¿‡æ ‡é¢˜è¡Œ
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        const data = line.split(',');
                        if (data.length >= 6) {
                            const cargo = new Cargo({
                                name: data[0],
                                length: data[1],
                                width: data[2],
                                height: data[3],
                                weight: data[4],
                                quantity: data[5],
                                fragile: data[6] === 'æ˜¯' ? 'true' : 'false',
                                stackable: data[7] === 'å¦' ? 'false' : 'true'
                            });
                            cargoItems.push(cargo);
                        }
                    }
                }
                
                updateCargoList();
                alert(`æˆåŠŸå¯¼å…¥ ${lines.length - 1} æ¡è´§ç‰©ä¿¡æ¯ï¼`);
            };
            
            reader.readAsText(file);
        }
        
        // é‡ç½®æ‰€æœ‰
        function resetAll() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                cargoItems = [];
                solutions = [];
                currentSolution = null;
                
                if (cargoGroup) scene.remove(cargoGroup);
                
                updateCargoList();
                updateSolutionsList();
                
                document.getElementById('load-ratio').textContent = '0%';
                document.getElementById('loaded-items').textContent = '0';
                document.getElementById('total-weight').textContent = '0kg';
                document.getElementById('center-deviation').textContent = '0cm';
            }
        }
        
        // çª—å£å¤§å°è°ƒæ•´
        window.addEventListener('resize', function() {
            const container = document.getElementById('scene-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initScene();
        });
    </script>
</body>
</html>